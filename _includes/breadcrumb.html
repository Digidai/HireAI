{%- comment -%}
  面包屑导航组件
  包含可视化面包屑和 BreadcrumbList Schema.org 结构化数据
{%- endcomment -%}

{%- assign breadcrumb_items = page.breadcrumb | default: layout.breadcrumb | default: nil -%}

{%- if breadcrumb_items -%}
  {%- comment -%} 生成 BreadcrumbList 结构化数据 {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {%- for item in breadcrumb_items -%}
        {%- assign item_name = item.name -%}
        {%- if item_name contains "page.title" or item_name contains "{{" -%}
          {%- assign item_name = page.title | default: page.tag | default: "Page" -%}
        {%- endif -%}
        {
          "@type": "ListItem",
          "position": {{ forloop.index }},
          "name": {{ item_name | jsonify }},
          "item": "{{ item.url | absolute_url | escape }}"
        }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  }
  </script>

  {%- comment -%} 可视化面包屑导航 {%- endcomment -%}
  <nav class="breadcrumb-nav" aria-label="Breadcrumb">
    <ol class="breadcrumb-list" itemscope itemtype="https://schema.org/BreadcrumbList">
      {%- for item in breadcrumb_items -%}
        {%- assign item_name = item.name -%}
        {%- if item_name contains "page.title" or item_name contains "{{" -%}
          {%- assign item_name = page.title | default: page.tag | default: "Page" -%}
        {%- endif -%}
        <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          {%- if item.url -%}
            <a href="{{ item.url | relative_url }}" itemprop="item">
              <span itemprop="name">{{ item_name | escape }}</span>
            </a>
          {%- else -%}
            <span itemprop="name">{{ item_name | escape }}</span>
          {%- endif -%}
          <meta itemprop="position" content="{{ forloop.index }}" />
        </li>
      {%- endfor -%}
    </ol>
  </nav>
{%- endif -%}
